# 🧾 Linux top 命令使用文档

------

## 一、命令简介

`top` 是 Linux 系统中最常用的性能监控工具之一，用于**实时显示系统中各个进程的运行情况**和系统整体的资源使用情况（CPU、内存、负载等）。

它相当于 Windows 系统的 “任务管理器 (Task Manager)”。

------

## 二、命令语法

```bash
top [选项]
```

常用格式：

```bash
top -d 秒数 -p PID -u 用户名 -n 次数
```

------

## 三、常用选项

| 选项        | 说明                                 |
| ----------- | ------------------------------------ |
| `-d 秒数`   | 指定刷新时间间隔（默认 3 秒）        |
| `-p PID`    | 仅监控指定的进程                     |
| `-u 用户名` | 仅显示指定用户的进程                 |
| `-n 次数`   | 更新指定次数后退出                   |
| `-b`        | 批处理模式（输出结果到文件或脚本中） |
| `-H`        | 显示线程（Threads）                  |
| `-c`        | 显示完整命令行（默认只显示进程名）   |
| `-i`        | 忽略闲置和僵尸进程                   |
| `-o 字段名` | 指定排序字段（如 `%CPU`、`%MEM`）    |
| `-w`        | 宽屏模式显示，防止字段换行           |
| `-h`        | 显示帮助信息                         |
| `-v`        | 显示版本信息                         |

------

## 四、top 界面说明

运行 `top` 后，会看到动态刷新的界面，一般分为 **两部分**：

------

### （一）系统概要信息（前 5 行）

示例：

```
top - 16:20:01 up 3 days,  4:15,  2 users,  load average: 0.22, 0.18, 0.15
Tasks: 231 total,   1 running, 230 sleeping,   0 stopped,   0 zombie
%Cpu(s):  5.6 us,  2.3 sy,  0.0 ni, 91.8 id,  0.1 wa,  0.0 hi,  0.2 si,  0.0 st
MiB Mem :  15927.6 total,   3256.4 free,   4382.9 used,   8288.3 buff/cache
MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.  9321.5 avail Mem
```

------

#### 1️⃣ 第一行：系统运行时间和负载

| 字段         | 含义                               |
| ------------ | ---------------------------------- |
| 当前时间     | 系统时间                           |
| up           | 系统已运行时间                     |
| users        | 当前登录用户数                     |
| load average | 系统负载（最近 1/5/15 分钟平均值） |

> 💡 **负载判断参考**：
>
> - 负载 ≈ CPU 核数 → 系统压力中等
> - 负载 > CPU 核数 → 系统繁忙

------

#### 2️⃣ 第二行：任务（进程）总览

```
Tasks: 231 total, 1 running, 230 sleeping, 0 stopped, 0 zombie
```

| 状态     | 含义               |
| -------- | ------------------ |
| total    | 进程总数           |
| running  | 运行中             |
| sleeping | 睡眠中（等待资源） |
| stopped  | 被暂停             |
| zombie   | 僵尸进程           |

------

#### 3️⃣ 第三行：CPU 使用情况

```
%Cpu(s):  5.6 us,  2.3 sy,  0.0 ni, 91.8 id,  0.1 wa,  0.0 hi,  0.2 si,  0.0 st
```

| 字段   | 含义                           |
| ------ | ------------------------------ |
| **us** | 用户空间使用率（user space）   |
| **sy** | 内核空间使用率（system）       |
| **ni** | 调整 nice 值进程占用率         |
| **id** | 空闲 CPU 百分比                |
| **wa** | 等待 I/O 的 CPU 百分比         |
| **hi** | 硬件中断                       |
| **si** | 软件中断                       |
| **st** | 虚拟机窃取的 CPU 时间（steal） |

> ⚠️ 注意：
>
> - `us + sy` 高 → CPU 压力大
> - `wa` 高 → I/O 瓶颈
> - `st` 高 → 虚拟化资源被占用

------

#### 4️⃣ 第四、五行：内存使用情况

```
MiB Mem : 15927.6 total, 3256.4 free, 4382.9 used, 8288.3 buff/cache
MiB Swap: 2048.0 total, 2048.0 free, 0.0 used. 9321.5 avail Mem
```

| 字段       | 含义               |
| ---------- | ------------------ |
| total      | 物理内存总量       |
| free       | 空闲内存           |
| used       | 使用中内存         |
| buff/cache | 缓存与缓冲内存     |
| avail Mem  | 系统可用内存估算值 |
| Swap       | 交换分区使用情况   |

------

### （二）进程列表部分

示例：

```
  PID  USER   PR  NI  VIRT  RES  SHR  S  %CPU  %MEM  TIME+   COMMAND
```

| 字段        | 含义                                   |
| ----------- | -------------------------------------- |
| **PID**     | 进程号                                 |
| **USER**    | 进程所属用户                           |
| **PR**      | 优先级                                 |
| **NI**      | nice 值（影响优先级）                  |
| **VIRT**    | 进程虚拟内存总量                       |
| **RES**     | 实际占用物理内存                       |
| **SHR**     | 共享内存                               |
| **S**       | 状态（R=运行，S=睡眠，Z=僵尸，T=停止） |
| **%CPU**    | CPU 占用率                             |
| **%MEM**    | 内存占用率                             |
| **TIME+**   | 进程累计运行时间                       |
| **COMMAND** | 进程执行的命令                         |

------

## 五、交互按键操作（运行中使用）

| 按键        | 功能说明                    |
| ----------- | --------------------------- |
| `h`         | 显示帮助                    |
| `q`         | 退出                        |
| `P`         | 按 CPU 使用率排序           |
| `M`         | 按内存使用率排序            |
| `T`         | 按运行时间排序              |
| `N`         | 按 PID 排序                 |
| `c`         | 显示完整命令行              |
| `u`         | 按用户过滤                  |
| `k`         | 终止进程（输入 PID）        |
| `r`         | 修改进程优先级（renice）    |
| `1`         | 显示每个 CPU 核心使用率     |
| `H`         | 显示/隐藏线程信息           |
| `Shift + W` | 保存配置（写入 `~/.toprc`） |

------

## 六、常见用法示例

### 1️⃣ 每 1 秒刷新一次

```bash
top -d 1
```

### 2️⃣ 仅显示 root 用户进程

```bash
top -u root
```

### 3️⃣ 仅监控指定进程

```bash
top -p 1234
```

### 4️⃣ 批处理模式输出（非交互）

```bash
top -b -n 3 > top.log
```

### 5️⃣ 按内存使用排序

```bash
top -o %MEM
```

### 6️⃣ 显示每个 CPU 核心使用率

进入 `top` 后按 **1**

------

## 七、性能分析参考

| 指标         | 正常值范围      | 问题表现               |
| ------------ | --------------- | ---------------------- |
| load average | 小于 CPU 核心数 | 大于核心数时 CPU 忙    |
| %us + %sy    | < 90%           | 超过说明 CPU 压力大    |
| %wa          | < 5%            | 高表示 I/O 阻塞        |
| %st          | < 5%            | 虚拟机抢占严重         |
| Swap used    | ≈ 0             | 有使用说明内存不足     |
| Zombie       | 0               | 有僵尸进程说明程序异常 |

------

## 八、实战场景示例

### 1️⃣ 定位 CPU 占用高的进程

```bash
top
```

→ 按 **P** 排序，查看最上方进程。

------

### 2️⃣ 定位内存占用高的进程

```bash
top
```

→ 按 **M** 排序。

------

### 3️⃣ 监控某个程序性能变化

```bash
top -p $(pidof nginx)
```

------

### 4️⃣ 保存快照数据

```bash
top -b -n 1 > /tmp/top_snapshot.txt
```

------

### 5️⃣ 查看每核 CPU 使用情况

运行中按数字键 `1`

------

## 九、与其他命令的配合

| 命令                       | 说明                               |
| -------------------------- | ---------------------------------- |
| `vmstat`                   | 查看 CPU、内存、I/O 概况           |
| `iostat`                   | 磁盘 I/O 监控                      |
| `free -h`                  | 查看内存使用                       |
| `ps -eo pid,pcpu,pmem,cmd` | 精确过滤输出                       |
| `htop`                     | `top` 的增强图形版本（可鼠标操作） |

------

## 十、总结

| 分类         | 内容                                             |
| ------------ | ------------------------------------------------ |
| **功能**     | 实时监控进程、CPU、内存使用情况                  |
| **重点关注** | load average、%CPU、%MEM、wa、Swap               |
| **常用选项** | `-d`、`-p`、`-u`、`-n`、`-b`                     |
| **交互按键** | `P`（CPU排序）、`M`（内存排序）、`1`（显示多核） |
| **使用建议** | 在系统卡顿时优先使用 top 定位问题                |

------

## 📘 十一、扩展说明

`top` 的增强工具：

- **htop**：图形化界面、可交互选择和结束进程。
- **atop**：支持历史性能记录与回放。
- **glances**：多维度监控（CPU、内存、网络、磁盘等）。

安装示例：

```bash
yum install htop -y     # CentOS / RHEL
apt install htop -y     # Debian / Ubuntu
```

------

## 🧠 十二、结语

`top` 是 Linux 性能排查的“第一眼”，
 掌握它，你可以快速判断：

- 系统是 **CPU 忙** 还是 **I/O 忙**
- 是 **内存不足** 还是 **程序异常**
- 哪个进程是“罪魁祸首”

熟练运用 `top`，你将成为真正懂系统的人。 🚀

------

是否希望我帮你把这份《top 命令使用文档》导出为
 ✅ **Markdown + PDF 格式文件**（排版清晰、表格高亮、适合培训或保存）？