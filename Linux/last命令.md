# 📜 **last 命令详解**

`last` 用于 **查看系统的历史登录记录**。
 它从 `/var/log/wtmp` 文件中读取用户登录、退出、重启等历史信息。

可以用来：

- 查看谁登录过服务器
- 查看非法登录尝试
- 查看历史重启记录
- 审计运维操作

------

# 🧩 **基本语法**

```bash
last [选项] [用户名]
```

------

# 📌 **典型输出说明**

执行：

```bash
last
```

示例：

```
root     pts/0        192.168.1.10    Mon Jan 13 09:32   still logged in
user1    pts/1        10.0.0.5        Mon Jan 13 08:50 - 09:10  (00:20)
reboot   system boot  5.15.0-60-generic Mon Jan 13 08:45 - 09:32 (00:47)
```

字段说明：

| 字段                    | 说明                        |
| ----------------------- | --------------------------- |
| `root`                  | 登录用户名                  |
| `pts/0`                 | 登录终端                    |
| `192.168.1.10`          | 来源 IP                     |
| `Mon Jan 13 09:32`      | 登录时间                    |
| `still logged in`       | 当前仍在登录                |
| `08:50 - 09:10 (00:20)` | 登录到退出的时间及时长      |
| `reboot`                | 系统重启记录（system boot） |

------

# 📌 常用选项

| 选项        | 说明                                       |
| ----------- | ------------------------------------------ |
| `-n number` | 只显示最近 N 条记录                        |
| `-f file`   | 指定其它 wtmp 文件                         |
| `-R`        | 不显示来源 IP 地址                         |
| `-x`        | 显示系统事件（reboot、shutdown、runlevel） |
| `-F`        | 显示更完整的时间格式                       |
| `-a`        | 将主机名显示在最后一列                     |

------

# 🧪 **常用示例**

------

### ⭐ 1. 查看全部历史登录记录

```bash
last
```

------

### ⭐ 2. 查看最近 10 条记录

```bash
last -n 10
```

------

### ⭐ 3. 查看某个用户的登录历史

```bash
last user1
```

------

### ⭐ 4. 查看系统重启历史

```bash
last reboot
```

或：

```bash
last -x | grep reboot
```

------

### ⭐ 5. 查看关机事件

```bash
last -x | grep shutdown
```

------

### ⭐ 6. 显示完整时间

```bash
last -F
```

------

### ⭐ 7. 按日期“倒序显示”主机名在最后

```bash
last -a
```

------

# 📜 日志来源文件

`last` 从以下文件读取数据：

| 文件            | 说明                                  |
| --------------- | ------------------------------------- |
| `/var/log/wtmp` | 登录/登出记录（主要文件）             |
| `/var/log/btmp` | **失败登录记录**（配合 `lastb` 使用） |
| `/var/log/utmp` | 当前登录状态（给 `who` 使用）         |

------

# 🛡️ 相关命令

| 命令                 | 作用                                 |
| -------------------- | ------------------------------------ |
| `last`               | 查看成功登录/重启等历史记录          |
| `lastb`              | 查看失败登录记录（SSH 暴力破解排查） |
| `who`                | 当前在线用户                         |
| `w`                  | 在线用户 + 系统负载                  |
| `journalctl -u sshd` | 查看 SSH 登录日志                    |

