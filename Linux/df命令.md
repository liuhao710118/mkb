# Linux `df` 命令详细教程

本文将详细介绍 Linux 中的 `df`（disk free）命令，包括其作用、常用选项、使用示例、进阶技巧以及与其它命令（如 `du`）的区别。

------

## 1. `df` 是什么？

`df`（disk free）用于显示文件系统的磁盘空间使用情况，包括总容量、已用空间、可用空间以及挂载点等信息，是 Linux 系统中最常用的磁盘监控工具之一。

命令格式：

```
df [options] [FILE]...
```

如果不带参数默认显示所有已挂载文件系统的信息。

------

## 2. `df` 输出字段说明

运行 `df -h` 可看到类似输出：

```
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda3       100G   60G   35G  63% /
tmpfs            16G     0   16G   0% /dev/shm
/dev/sda1       500M  120M  380M  25% /boot
```

字段含义：

- **Filesystem**：文件系统名称（如磁盘设备、LVM、NFS、tmpfs 等）
- **Size**：文件系统总容量
- **Used**：已用空间
- **Avail**：可用空间
- **Use%**：已使用百分比
- **Mounted on**：挂载点路径

------

## 3. `df` 常用选项

### 3.1 `-h`：以易读格式显示（常用）

```
df -h
```

以 KB/MB/GB 自动换算，更直观。

### 3.2 `-H`：以 1000 进制显示

采用 1K=1000 字节（与硬盘厂商一致），区别于 `-h` 的 1K=1024。

### 3.3 `-T`：显示文件系统类型

```
df -Th
```

输出示例：ext4、xfs、tmpfs、nfs 等。

### 3.4 `-i`：查看 inode 使用情况

```
df -i
```

用于排查 inode 耗尽问题（即便空间足够也无法写入）。

### 3.5 `-a`：显示全部文件系统（包括伪文件系统）

```
df -a
```

会包括 `/proc` 等特殊系统，不常用。

### 3.6 `-x`：排除某些类型文件系统

排除临时文件系统（例如 tmpfs）：

```
df -x tmpfs -h
```

### 3.7 `-t`：只显示指定文件系统类型

只显示 ext4 文件系统：

```
df -t ext4 -h
```

------

## 4. 指定路径查看所属文件系统使用情况

```
df -h /var/log
```

可快速确定某个目录所在分区是否已满，常用于排查磁盘告警。

------

## 5. `df` 与 `du` 的区别

| 命令 | 作用                                       |
| ---- | ------------------------------------------ |
| `df` | 查看整个文件系统的剩余空间（从磁盘角度）   |
| `du` | 查看某个文件或目录占用的空间（从文件角度） |

两者可能不同步，原因可能包括：

- 文件被删除但仍被进程占用
- 磁盘预留空间（如 ext4 给 root 预留的 5%）
- 硬链接、稀疏文件等机制

------

## 6. 实战示例

### 6.1 查看系统整体磁盘使用情况

```
df -h
```

### 6.2 查看 `/home` 分区是否快满

```
df -h /home
```

### 6.3 显示文件系统类型

```
df -Th
```

### 6.4 排查 inode 是否耗尽

```
df -i
```

------

## 7. 进阶排查技巧

### 7.1 判断是否因 inode 耗尽导致“磁盘满”

```
df -h
# 若空间充足，但仍提示无法写入文件，则检查 inode

df -i
```

### 7.2 找出哪个目录占用最大空间

搭配 du：

```
du -sh /* | sort -h
```

### 7.3 查看被删除但仍占用空间的文件

```
lsof | grep deleted
```

------

## 8. 常见问题 FAQ

### Q1：`df` 空间明明足够，但系统提示“磁盘已满”？

可能原因：inode 用完、文件被删除但仍被占用、磁盘预留空间等。

### Q2：为什么 `df -h` 和 `du -sh /dir` 的结果不一致？

参见第 5 节，两者统计方式不同。

### Q3：如何使用脚本定期监控磁盘情况？

```
#!/bin/bash
used=$(df / | tail -1 | awk '{print $5}' | tr -d '%')
if [ $used -gt 80 ]; then
  echo "Disk usage over 80%" | mail -s "Disk Alert" admin@example.com
fi
```

------

## 9. 总结

`df` 是 Linux 下用于查看磁盘总体使用情况的基础命令，通过配合 `-h`、`-T`、`-i` 等参数，可以快速定位磁盘空间、文件系统类型、inode 使用情况等问题。搭配 `du`、`lsof` 等命令能更高效排查空间相关故障。

如需进一步扩展或需要脚本化版本，请继续告诉我。