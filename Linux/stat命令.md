# **Linux `stat` 命令教程**

## 一、`stat` 是什么？

`stat` 用来显示 **文件或文件系统的状态信息**，比 `ls -l` 提供更全面的数据，包括：

- 文件大小
- 权限（含八进制）
- inode 编号
- 所属用户/用户组
- 文件创建、修改、访问时间
- 文件类型
- 硬链接数量

它是排查文件权限/属性、查看时间戳的重要工具。

------

# **二、基本语法**

```
stat [选项] 文件路径
```

例子：

```
stat /etc/passwd
```

------

# **三、默认输出解析**

示例输出：

```
File: passwd
Size: 2783            Blocks: 8          IO Block: 4096   regular file
Device: 802h/2050d    Inode: 393268      Links: 1
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2024-10-26 11:22:10 +0800
Modify: 2024-10-26 11:22:10 +0800
Change: 2024-10-26 11:22:10 +0800
Birth: 2024-10-01 09:20:10 +0800
```

字段说明：

| 字段              | 说明                       |
| ----------------- | -------------------------- |
| **Size**          | 文件大小（字节）           |
| **Blocks**        | 占用的磁盘块               |
| **IO Block**      | 执行 I/O 的块大小          |
| **Inode**         | inode 编号                 |
| **Links**         | 硬链接数量                 |
| **Access (0644)** | 权限（八进制 + 符号格式）  |
| **Uid/Gid**       | 用户 + 用户组              |
| **Access 时间**   | 最后访问时间 (atime)       |
| **Modify 时间**   | 内容修改时间 (mtime)       |
| **Change 时间**   | 元数据修改时间 (ctime)     |
| **Birth**         | 创建时间（部分文件系统无） |

------

# **四、常用参数说明**

| 参数              | 说明                       |
| ----------------- | -------------------------- |
| `-c FORMAT`       | 自定义输出格式             |
| `--printf=FORMAT` | 格式化输出（更强大）       |
| `-f`              | 查询文件系统而不是文件本身 |
| `--terse`         | 简洁输出                   |
| `--help`          | 查看帮助                   |

------

# **五、自定义输出（非常实用）**

### 1. 输出文件权限（八进制）

```
stat -c "%a" test.txt
```

输出例：

```
644
```

### 2. 输出文件所有者

```
stat -c "%U" test.txt
```

### 3. 输出 inode 编号

```
stat -c "%i" test.txt
```

### 4. 输出文件大小

```
stat -c "%s" test.txt
```

------

# **六、文件时间查看**

### 查看 Access / Modify / Change

```
stat -c "Access: %x" file
stat -c "Modify: %y" file
stat -c "Change: %z" file
```

------

# **七、查询文件系统信息**

使用 `-f`：

```
stat -f /
```

输出示例：

```
ID: 0x1234 Namelen: 255 Type: ext4
Block size: 4096     Fundamental block size: 4096
```

------

# **八、实际使用场景**

------

## **1. 判断文件是否有被修改过（看 mtime）**

```
stat -c "%y" my.conf
```

------

## **2. 排查权限问题（查看八进制权限）**

```
stat -c "%a %n" *
```

------

## **3. 监控谁修改了文件（配合 audit 等）**

```
stat -c "mtime=%y ctime=%z" config.yml
```

------

## **4. 判断文件创建时间（Birth）**

```
stat -c "%w" filename
```

如果显示 "-"，说明文件系统不支持创建时间。

------

## **5. 格式化输出多个字段**

```
stat --printf="Name: %n\nSize: %s\nOwner: %U\n" test.txt
```

------

# **九、常用格式化占位符速查表**

| 占位符 | 说明             |
| ------ | ---------------- |
| `%n`   | 文件名           |
| `%s`   | 文件大小（字节） |
| `%a`   | 权限（八进制）   |
| `%A`   | 权限（符号格式） |
| `%U`   | 所有者           |
| `%G`   | 所属组           |
| `%y`   | mtime            |
| `%x`   | atime            |
| `%z`   | ctime            |
| `%i`   | inode            |
| `%B`   | 块大小           |
| `%b`   | 占用块数         |

------

# **十、Cheat Sheet（快速速查）**

| 功能             | 命令                |
| ---------------- | ------------------- |
| 查看文件完整信息 | `stat file`         |
| 查看八进制权限   | `stat -c "%a" file` |
| 查看文件修改时间 | `stat -c "%y" file` |
| 查看 inode       | `stat -c "%i" file` |
| 查看文件所有者   | `stat -c "%U" file` |
| 查看文件系统信息 | `stat -f /path`     |

