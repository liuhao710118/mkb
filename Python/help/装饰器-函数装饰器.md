# ğŸš€ 1. è£…é¥°å™¨æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸€å¥è¯è§£é‡Šï¼‰

**è£…é¥°å™¨ = é—­åŒ… + è¯­æ³•ç³–ï¼Œç”¨æ¥åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç çš„å‰æä¸‹ï¼Œç»™å‡½æ•°å¢åŠ åŠŸèƒ½ã€‚**

ç¤ºä¾‹ï¼š

```python
@decorator
def func():
    pass
```

ç­‰ä»·äºï¼š

```python
func = decorator(func)
```

------

# ğŸ§© 2. è£…é¥°å™¨æœ¬è´¨ï¼ˆæ ¸å¿ƒç»“æ„ï¼‰

æœ¬è´¨å°±æ˜¯ä¸€ä¸ª **æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›æ–°å‡½æ•°çš„å‡½æ•°**ï¼š

```python
def decorator(func):
    def wrapper(*args, **kwargs):
        # åœ¨è¿™é‡Œå¢åŠ åŠŸèƒ½
        result = func(*args, **kwargs)
        return result
    return wrapper
```

å†ä½¿ç”¨ï¼š

```python
@decorator
def hello():
    print("Hello")

hello()
```

------

# ğŸ¯ 3. æœ€å¸¸è§è£…é¥°å™¨ç¤ºä¾‹ï¼ˆç†è§£æœ€å¿«ï¼‰

## 3.1 æ—¥å¿—è£…é¥°å™¨

```python
def log(func):
    def wrapper(*args, **kwargs):
        print(f"calling {func.__name__}")
        return func(*args, **kwargs)
    return wrapper

@log
def add(a, b):
    return a + b

print(add(3, 5))
```

æ‰§è¡Œé¡ºåºï¼š

1. æ¨¡å—åŠ è½½æ—¶ï¼š`add = log(add)`
2. è°ƒç”¨å‡½æ•°æ—¶ï¼šè¿›å…¥ wrapperï¼Œå†è°ƒç”¨åŸå‡½æ•°

------

# âš  4. è£…é¥°å™¨çš„å¸¸è§å‘ï¼šå‡½æ•°ä¿¡æ¯ä¸¢å¤±

è£…é¥°å™¨ä¼šå¯¼è‡´ï¼š

- åŸå‡½æ•°çš„ `__name__`
- æ–‡æ¡£å­—ç¬¦ä¸² `__doc__`
- ç±»å‹æ³¨è§£

è¢« wrapper è¦†ç›–ã€‚

è§£å†³æ–¹æ³•ï¼š**functools.wraps**

```python
from functools import wraps

def log(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        print(f"calling {func.__name__}")
        return func(*args, **kwargs)
    return wrapper
```

------

# ğŸ§± 5. è£…é¥°å™¨å¸¦å‚æ•°ï¼ˆè£…é¥°å™¨å·¥å‚ï¼‰

ä¾‹å­ï¼šå¸Œæœ›ä¼ å…¥æ—¥å¿—çº§åˆ«

```python
def log(level):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            print(f"[{level}] {func.__name__}")
            return func(*args, **kwargs)
        return wrapper
    return decorator
```

ä½¿ç”¨ï¼š

```python
@log("INFO")
def hello():
    print("hello")
```

åŸç†ï¼šä¸‰å±‚å‡½æ•°ç»“æ„

```
log(level) â†’ decorator(func) â†’ wrapper()
```

------

# ğŸ§° 6. è£…é¥°å™¨çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼ˆæœ€å®ç”¨çš„ï¼‰

## âœ” 6.1 æƒé™æ§åˆ¶ï¼ˆä¾‹å¦‚ Web åç«¯ï¼‰

```python
def need_admin(func):
    @wraps(func)
    def wrapper(user, *args, **kwargs):
        if not user.is_admin:
            raise PermissionError("no permission")
        return func(user, *args, **kwargs)
    return wrapper
```

------

## âœ” 6.2 è¿è¡Œæ—¶é—´ç»Ÿè®¡

```python
import time

def timeit(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f"{func.__name__} took {end - start:.4f}s")
        return result
    return wrapper
```

------

## âœ” 6.3 ç¼“å­˜ç»“æœï¼ˆæ‰‹å†™ç‰ˆ @functools.lru_cacheï¼‰

```python
def memo(func):
    cache = {}
    @wraps(func)
    def wrapper(*args):
        if args in cache:
            return cache[args]
        res = func(*args)
        cache[args] = res
        return res
    return wrapper
```

------

## âœ” 6.4 é‡è¯•æœºåˆ¶ï¼ˆå¤±è´¥è‡ªåŠ¨é‡è¯•ï¼‰

```python
import time
from functools import wraps

def retry(times=3, delay=1):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for i in range(times):
                try:
                    return func(*args, **kwargs)
                except Exception:
                    if i == times - 1:
                        raise
                    time.sleep(delay)
        return wrapper
    return decorator
```

------

# ğŸŒ€ 7. å¤šé‡è£…é¥°å™¨ï¼ˆè£…é¥°å™¨é“¾ï¼‰

å¤šä¸ªè£…é¥°å™¨ï¼š

```python
@d1
@d2
@d3
def func():
    pass
```

æ‰§è¡Œé¡ºåºï¼ˆä»é‡Œåˆ°å¤–ï¼‰ï¼š

```
func = d1(d2(d3(func)))
```

------

# ğŸ§¬ 8. ç±»æ–¹æ³•çš„è£…é¥°å™¨

ç›´æ¥ç»™ç±»æ–¹æ³•åŠ è£…é¥°å™¨ï¼š

```python
class A:
    @timeit
    def work(self):
        print("working")
```

------

# ğŸ§± 9. ç±»è£…é¥°å™¨ï¼ˆé«˜çº§ç”¨æ³•ï¼‰

è£…é¥°å™¨ä¸ä¸€å®šæ˜¯å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»ï¼š

```python
class Log:
    def __init__(self, func):
        self.func = func
    def __call__(self, *args, **kwargs):
        print("call", self.func.__name__)
        return self.func(*args, **kwargs)

@Log
def hello():
    print("Hello")
```

ç±»è£…é¥°å™¨é€‚åˆéœ€è¦ **æ›´å¤æ‚çŠ¶æ€** çš„åœºæ™¯ã€‚

------

# ğŸ§  10. è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªçœŸæ­£æœ‰ç”¨çš„è£…é¥°å™¨ï¼ˆä¸šåŠ¡çº§ï¼‰

## ä¾‹ï¼šå¯¹å‡½æ•°æ‰§è¡ŒåŠ é”ï¼ˆå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¸¸ç”¨ï¼‰

```python
import threading
from functools import wraps

def synchronized(lock=None):
    if lock is None:
        lock = threading.Lock()

    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            with lock:
                return func(*args, **kwargs)
        return wrapper
    return decorator
```

ä½¿ç”¨ï¼š

```python
lock = threading.Lock()

@synchronized(lock)
def update():
    ...
```

ä½ å·²ç»å¯ä»¥å†™ç”Ÿäº§çº§è£…é¥°å™¨äº†ã€‚

------

# ğŸ“Œ 11. è£…é¥°å™¨åº•å±‚åŸç†ï¼ˆä½ å†™è£…é¥°å™¨å¿…é¡»æ‡‚ï¼‰

ä»¥ä¸‹ä»£ç ï¼š

```python
@deco
def f():
    pass
```

ç­‰ä»·äºï¼š

```python
def f():
    pass
f = deco(f)
```

**è£…é¥°å™¨å‘ç”Ÿåœ¨å‡½æ•°å®šä¹‰é˜¶æ®µï¼Œè€Œä¸æ˜¯è°ƒç”¨é˜¶æ®µ**
å³æ¨¡å—å¯¼å…¥æ—¶å°±æ‰§è¡Œã€‚

------

# ğŸ§© 12. è¶…å¼ºæ€»ç»“ï¼ˆ10 ç§’æŒæ¡æ ¸å¿ƒï¼‰

âœ” è£…é¥°å™¨ = åŒ…è£…å‡½æ•°ï¼Œå¢å¼ºåŠŸèƒ½
âœ” æœ¬è´¨ = é—­åŒ…
âœ” ä½¿ç”¨è¯­æ³•ç³– `@decorator`
âœ” å¤šå±‚è£…é¥°å™¨ä»ä¸‹åˆ°ä¸Šæ‰§è¡Œ
âœ” å¿…é¡»ç”¨ `functools.wraps` ä¿ç•™åŸå‡½æ•°ä¿¡æ¯
âœ” å¯åšæ—¥å¿—ã€é‰´æƒã€ç¼“å­˜ã€é‡è¯•ã€é™æµç­‰å¤æ‚é€»è¾‘

