# **Linux `iostat` 命令教程文档**

`iostat`（Input/Output Statistics）是 Linux 系统中用于监控 **CPU 使用率** 和 **磁盘 I/O 性能** 的重要工具，常用于服务器性能分析、瓶颈定位、磁盘延迟诊断。

`iostat` 属于 **sysstat 工具包**，使用前需安装：

```
yum install sysstat        # CentOS/RHEL
apt install sysstat        # Ubuntu/Debian
```

------

# **一、基本语法**

```
iostat [选项] [interval] [count]
```

- **interval**：刷新时间间隔（秒）
- **count**：显示次数

例如：

```
iostat 2 5
```

表示每 2 秒采样一次，一共采样 5 次。

------

# **二、输出内容说明**

## **1. CPU 部分**

| 字段        | 含义                                |
| ----------- | ----------------------------------- |
| **%user**   | 用户态 CPU 使用率                   |
| **%nice**   | 低优先级进程使用率                  |
| **%system** | 内核态 CPU 使用率                   |
| **%iowait** | CPU 等待 I/O 百分比（越高越不好）   |
| **%steal**  | 虚拟化环境中被宿主机抢占的 CPU 时间 |
| **%idle**   | CPU 空闲时间                        |

**关键指标：%iowait**

- **>30%**：通常表明磁盘 I/O 已成为系统瓶颈
- **接近 0%**：说明磁盘 I/O 正常

------

## **2. 磁盘 I/O 部分**

### 常见字段解释：

| 字段          | 含义                              |
| ------------- | --------------------------------- |
| **tps**       | 每秒 I/O 请求数（读/写次数）      |
| **kB_read/s** | 每秒读数据量                      |
| **kB_wrtn/s** | 每秒写数据量                      |
| **kB_read**   | 总读取 KB                         |
| **kB_wrtn**   | 总写入 KB                         |
| **r/s**       | 每秒读请求数                      |
| **w/s**       | 每秒写请求数                      |
| **rkB/s**     | 读吞吐量 KB/s                     |
| **wkB/s**     | 写吞吐量 KB/s                     |
| **await**     | 单个 I/O 请求平均等待时间（毫秒） |
| **svctm**     | 磁盘服务时间（毫秒）（已被废弃）  |
| **%util**     | 磁盘忙碌率（100% 表示磁盘满负荷） |

重点关注：

- **await > 20ms**：磁盘延迟偏高
- **%util > 80%**：磁盘接近满载
- **%util=100% + await 也高**：磁盘瓶颈严重

------

# **三、常用示例**

## **1. 查看 CPU 和磁盘 I/O 基本信息**

```
iostat
```

------

## **2. 每 2 秒刷新一次 CPU/I/O 状态**

```
iostat 2
```

------

## **3. 显示更详细的小节统计（推荐）**

```
iostat -x 2
```

**-x（extended）** 会显示 **await、%util、r/s、w/s 等高级指标**。

------

## **4. 只查看磁盘设备，不看 CPU**

```
iostat -d 2 5
```

------

## **5. 查看所有设备的详细 I/O 指标**

```
iostat -xd 1
```

`-x`：扩展指标
 `-d`：仅显示磁盘

------

## **6. 查看设备 sda 的详细 I/O**

```
iostat -x 1 | grep sda
```

------

## **7. 查看设备使用情况（MB/s 显示）**

```
iostat -m -x 2
```

------

## **四、如何解读 iostat（实际诊断经验）**

### **1. 判断磁盘是否成为瓶颈**

查看 **%util**：

- 80–100% → 磁盘几乎被打满
- 将导致 CPU 等待 I/O（iowait 高）

查看 **await**：

- > 20 ms（机械盘）或 > 1 ms（SSD） → 延迟异常

若出现：

```
await 高 + %util 高
```

说明磁盘负载过高。

------

### **2. 判断 I/O 是读瓶颈还是写瓶颈**

看 `r/s` 和 `w/s` 或 `rkB/s`、`wkB/s`。

例：

```
r/s 很高，wkB/s 很低 → 读压力高
w/s 很高 → 写压力高
```

------

### **3. CPU 因 I/O 阻塞**

关注：

- **%iowait**
- **%util**

若：

- `%iowait` 很高（30%+）
- `%util` 接近 100%

说明 CPU 大量等待磁盘 → 磁盘瓶颈。

------

# **五、常见分析案例**

## **案例 1：日志写入过大**

```
Device:   %util   await   w/s
sda        98.0   30.0   2330
```

说明：

- 写请求多、磁盘忙、延迟大
- 存在日志/缓存写入压力

------

## **案例 2：数据库读压力过大**

```
r/s  1200
await 60 ms
%util 100%
```

说明：

- 高读请求
- I/O 明显瓶颈
- 数据库查询响应会变慢

------

# **六、总结**

`iostat` 是 Linux 中定位 I/O 性能问题的必备工具，可用于：

- 分析磁盘是否成为瓶颈
- 判断读写负载情况
- 定位数据库/应用性能问题
- 实时监控日志和系统状态

常用组合命令（最实用）：

```
iostat -x 1
iostat -xm 1
iostat -d 2 5
```

